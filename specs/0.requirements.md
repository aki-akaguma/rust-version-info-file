# Requirements for rust-version-info-file

This document outlines the functional requirements for the `rust-version-info-file` library.

## Core Functionality

- The library shall provide a public function, `rust_version_info_file`, to be used primarily in `build.rs` scripts.
- This function will gather version information about the Rust toolchain and the project's dependencies.
- The gathered information shall be written to a specified output file.

## Inputs

- The `rust_version_info_file` function must accept two arguments:
    1.  `dst`: The path to the destination file where the output will be saved.
    2.  `cargo_toml_file`: The path to the project's `Cargo.toml` file.

## Information Gathering

- The library must determine the `rustc` version by executing the `rustc --version` command.
- It must be able to locate the `rustc` executable, respecting the `RUSTC` environment variable if it is set.
- The library must generate a dependency tree by executing the `cargo tree` command.
- The `cargo tree` command should be pointed at the `Cargo.toml` file specified in the input arguments.
- The output from `cargo tree` should be captured without color codes.

## Output File

- The content written to the destination file shall be a concatenation of:
    1.  The output of `rustc --version`.
    2.  The processed output of `cargo tree`.
- The library shall only write to the destination file if its content has changed. It will read the existing file and compare its content to the newly generated content before writing.
- If the file needs to be written, it will be created if it does not exist, or truncated and overwritten if it does.

## Dependency Tree Processing

- The initial line of the `cargo tree` output, which typically includes the project's path, shall be processed to remove the path information, leaving only the crate name and version.
